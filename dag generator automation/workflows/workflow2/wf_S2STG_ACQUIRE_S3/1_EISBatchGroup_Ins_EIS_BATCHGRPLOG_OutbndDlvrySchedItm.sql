INSERT INTO {{SCHEMA_T}}.EIS_BTCHGRPLOG
(
SELECT 
C.RqstSID AS RQSTSID,
C.REQUEST_ID AS RQSTID,
'R' AS RQSTLOADSTATCD,
C.ETL_BtchGrpCd AS ETL_BtchGrpCd,
C.TOTAL_DELTAS AS TOTDLTACNT,
NULL AS THNDLTACNT,
NULL AS APLDDLTACNT, 
NULL AS INSERTBY,
NULL AS INSERTDT
FROM
	(
	SELECT 
	A.RqstSID,
	A.REQUEST_ID,
	A.ETL_BtchGrpCd, 
	A.TOTAL_DELTAS
	FROM 
		(
		SELECT 
		X.RqstSID,
		X.REQUEST_ID,
		X.ETL_BtchGrpCd, 
		COUNT(X.RqstSID) TOTAL_DELTAS
		FROM
			{{SCHEMA_STG}}.{{PARAMTGTTABLE}} X 
		WHERE 
			AUDITFK IN 
				(
				SELECT ETL_TABLE_AUDIT_PK FROM {{SCHEMA_T}}.A_ETL_TABLE_AUDIT WHERE TABLE_NAME = '{{PARAMTGTTABLE}}' AND TBL_ETL_STATUS = 'In Progress'
				)
				GROUP BY  
				X.RqstSID,X.REQUEST_ID, X.ETL_BtchGrpCd
		) A 
		INNER JOIN 
			{{SCHEMA_T}}.EIS_REQUEST_LOG B 
			ON 
			A.RqstSID = B.RqstSID AND 
			B.RQSTLoadStatCd = 'R'
	) C
); 



